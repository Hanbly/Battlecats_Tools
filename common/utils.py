# common/utils.py
import os
import sys
import subprocess
import time
import traceback
from datetime import time as dtime, datetime, timezone, timedelta
from zoneinfo import ZoneInfo, ZoneInfoNotFoundError

import cv2
import numpy as np
import win32con
import win32gui

from common.EmulatorStateManager import EmulatorStateManager
from common.ScreenCaptureManager import ScreenCaptureManager

DEBUG = True
debug_img = 'rego'


# 实例化全局状态管理器
emulator_state = EmulatorStateManager()


def initialize_emulator_state(window_title):
    """根据窗口标题初始化模拟器状态"""
    emulator_state.set_emulator_by_window_title(window_title)


########################################################################################################################
##############
# 通用脚本常量 #
##############
# 元素位置
positions_to_click = [
    (80, 977),  # 钱包升级
    (500, 830),  # 兵种1
    (720, 830),  # 兵2种2
    (940, 830),  # 兵种3
    (1170, 830),  # 兵种4
    (1380, 830),  # 兵种5
    (500, 924),  # 兵种6
    (720, 924),  # 兵种7
    (940, 924),  # 兵种8
    (1170, 924),  # 兵种9
    (1380, 924),  # 兵种10
    (1790, 924),  # 喵炮
]
# 出猫策略常量
positions_order_default = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11]
consume_positions_order_default = [1]
gold_positions_order_default = [3, 4, 5, 6, 7, 8, 9, 10, 11, 0]
legend_positions_order_default = [3, 4, 5, 6, 7, 8, 9, 10, 11, 0]
# 识别/操作/时延常量-脚本及工具方法使用
legend_range = {
    'start': [10, 250],
    'end': [660, 800]
}
single_vertical_roll_START = [950, 450]
single_vertical_roll_TOP_END = [950, 250]  # 上划
single_vertical_roll_BOTTOM_END = [950, 650]  # 下划
single_level_roll_START = [950, 450]
single_level_roll_TOP_END = [750, 450]  # 左划
single_level_roll_BOTTOM_END = [1150, 450]  # 右划

single_vertical_duration_ms = 300

legend_range_startX = legend_range.get('start')[0]
legend_range_startY = legend_range.get('start')[1]
legend_range_deltaX = legend_range.get('end')[0] - legend_range.get('start')[0]
legend_range_deltaY = legend_range.get('end')[1] - legend_range.get('start')[1]

enter_legend_time = 1  # 进入传说关卡时延
act_timeout_time = 3
back_to_main_place_time = 2
long_roll_break = 0.5  # 长滚动后时延

long_roll_length = 600  # 长滚动长度
long_roll_time_ms = 100  # 长滚动时间
default_long_roll_time_ms = 50  # 默认长滚动时间
long_roll_counts = 1  # 长滚动次数

########################################################################################################################
##############
# 图像识别常量 #
##############
# 日服可用
ROIS_jp = {

    "YES": (491, 526, 968 - 491, 900 - 526),
    "OK": (0, 0, 1920, 1080),
    "OK_MAP": (1207, 491, 1702 - 1207, 809 - 491),
    "X": (1587, 40, 1711 - 1587, 141 - 40),
    ###########
    # 加码/主线 #
    ###########
    # JAMA
    "rego": (1730, 60, 200, 200) if emulator_state.is_leidian() else (1730, 100, 200, 200),
    "6hour": (800, 360, 400, 250),
    "reward": (1400, 110, 1750 - 1400, 250 - 110),
    "reward_result": (630, 0, 1200 - 630, 1000),
    "member": (22, 557, 1887 - 22, 853 - 557),

    # Consume
    "start_fight_map": (1370, 690, 530, 145),
    "power_limited": (376, 398, 1543 - 376, 694 - 398),
    "skip": (1631, 950, 1901 - 1631, 1065 - 950),
    "start_game": (133, 261, 561 - 133, 367 - 261),

    # 刷金宝
    "gold": (1000, 80, 1200 - 1000, 170 - 80),
    "gold_left": (654, 110, 707 - 654, 155 - 110),
    "return_map": (1786, 22, 1905 - 1786, 124 - 22),

    # 刷不死入侵
    "change_map": (280, 0, 380 - 280, 120 - 0),
    "zombie_map": (964, 278, 1286 - 964, 411 - 278),
    "zombie_inner": (66, 681, 283 - 66, 827 - 681),

    ##########
    # 传说关卡 #
    ##########

}
# 台服可用
ROIS_tw = {

    "YES": (491, 526, 968 - 491, 900 - 526),
    "OK": (0, 0, 1920, 1080),
    "OK_MAP": (1207, 491, 1702 - 1207, 809 - 491),
    "X": (1587, 40, 1711 - 1587, 141 - 40),

    "power_limited": (791, 438, 1101 - 791, 517 - 438),
    ###########
    # 加码/主线 #
    ###########
    # JAMA
    "rego": (1730, 60, 200, 200) if emulator_state.is_leidian() else (1730, 100, 200, 200),
    "6hour": (800, 360, 400, 250),
    "reward": (1400, 110, 350, 100),
    "reward_result": (350, 0, 925 - 350, 1000),
    "member": (22, 557, 1887 - 22, 853 - 557),

    # Consume
    "start_fight_map": (1370, 690, 530, 145),
    "skip": (1631, 950, 1901 - 1631, 1065 - 950),
    "start_game": (133, 261, 561 - 133, 367 - 261),

    # 刷金宝
    "gold": (1000, 80, 1200 - 1000, 170 - 80),
    "gold_left": (654, 110, 707 - 654, 155 - 110),
    "return_map": (1786, 22, 1905 - 1786, 124 - 22),

    # 刷不死入侵
    "change_map": (280, 0, 380 - 280, 120 - 0),
    "zombie_map": (964, 278, 1286 - 964, 411 - 278),
    "zombie_inner": (66, 681, 283 - 66, 827 - 681),

    ##########
    # 传说关卡 #
    ##########
    "act_timeout": (393, 287, 1534 - 393, 641 - 287),
    # XP系列
    "XP_1": (legend_range_startX, legend_range_startY, legend_range_deltaX, legend_range_deltaY),
    "XP_2": (legend_range_startX, legend_range_startY, legend_range_deltaX, legend_range_deltaY),
    "XP_3": (legend_range_startX, legend_range_startY, legend_range_deltaX, legend_range_deltaY),
    "XP_4": (legend_range_startX, legend_range_startY, legend_range_deltaX, legend_range_deltaY),
    # 银券系列
    "cats_silver_chance": (legend_range_startX, legend_range_startY, legend_range_deltaX, legend_range_deltaY),
    "counterattack_THE_FACE_SIR": (legend_range_startX, legend_range_startY, legend_range_deltaX, legend_range_deltaY),
    "counterattack_THE_MIGHTY_HIPPOPOTAMUS": (
        legend_range_startX, legend_range_startY, legend_range_deltaX, legend_range_deltaY),
    # 薄荷系列
    "BoHe_aEXpart": (420, 340, 1500 - 420, 610 - 340),
    "BoHe_green": (legend_range_startX, legend_range_startY, legend_range_deltaX, legend_range_deltaY),
    "BoHe_purple": (legend_range_startX, legend_range_startY, legend_range_deltaX, legend_range_deltaY),
    "BoHe_red": (legend_range_startX, legend_range_startY, legend_range_deltaX, legend_range_deltaY),
    "BoHe_blue": (legend_range_startX, legend_range_startY, legend_range_deltaX, legend_range_deltaY),
    "BoHe_yellow": (legend_range_startX, legend_range_startY, legend_range_deltaX, legend_range_deltaY),
    "BoHe_vcolor": (legend_range_startX, legend_range_startY, legend_range_deltaX, legend_range_deltaY),
    "BoHe_ancient": (legend_range_startX, legend_range_startY, legend_range_deltaX, legend_range_deltaY)
}
BoHe_confidence_threshold = 0.9

########################################################################################################################
##############
# 活动时间常量 #
##############
# 星期一 Monday Mon
# 星期二 Tuesday Tues
# 星期三 Wednesday Wed
# 星期四 Thursday Thur
# 星期五 Friday Fri
# 星期六 Saturday Sat
# 星期日 Sunday Sun
month_day_kv = [
    'Day_01', 'Day_02', 'Day_03', 'Day_04', 'Day_05', 'Day_06', 'Day_07', 'Day_08', 'Day_09', 'Day_10',
    'Day_11', 'Day_12', 'Day_13', 'Day_14', 'Day_15', 'Day_16', 'Day_17', 'Day_18', 'Day_19', 'Day_20',
    'Day_21', 'Day_22', 'Day_23', 'Day_24', 'Day_25', 'Day_26', 'Day_27', 'Day_28', 'Day_29', 'Day_30',
    'Day_31',
]
week_day_kv = ['Mon', 'Tues', 'Wed', 'Thur', 'Fri', 'Sat', 'Sun']
activities_start_kv = [
    {'act_name': '----------------常规活动----------------'},
    # 银劵
    {'act_name': '貓咪券機會', 'Mon': ['07:00-08:00', '20:00-21:00'], 'Tues': ['11:00-12:00', '23:00-24:00'],
     'Wed': ['08:00-09:00', '16:00-17:00'],
     'Thur': ['13:00-14:00', '23:00-24:00'], 'Fri': ['08:00-09:00', '22:00-23:00'],
     'Sat': ['13:00-14:00', '21:00-22:00'],
     'Sun': ['11:00-12:00', '22:00-23:00']},
    {'act_name': '逆襲的河馬將', 'Day_01': ['07:00-08:00'], 'Day_04': ['11:00-12:00'], 'Day_07': ['16:00-17:00'],
     'Day_10': ['08:00-09:00'],
     'Day_13': ['12:00-13:00'], 'Day_16': ['17:00-18:00'], 'Day_19': ['13:00-14:00'], 'Day_22': ['19:00-20:00'],
     'Day_25': ['20:00-21:00'],
     'Day_28': ['21:00-22:00'], 'Day_31': ['22:00-23:00']},
    {'act_name': '逆襲的臉君', 'Day_02': ['00:00-12:00'], 'Day_05': ['12:00-24:00'], 'Day_08': ['00:00-12:00'],
     'Day_11': ['12:00-24:00'], 'Day_14': ['00:00-12:00'], 'Day_17': ['12:00-24:00'], 'Day_20': ['00:00-12:00'],
     'Day_23': ['12:00-24:00'], 'Day_26': ['00:00-12:00'], 'Day_29': ['12:00-24:00']},
    # 猫薄荷
    {'act_name': '绿色猫薄荷', 'Mon': ['00:00-24:00'], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [],
     'Sat': ['00:00-24:00'],
     'Sun': ['00:00-24:00']},
    {'act_name': '紫色猫薄荷', 'Mon': [], 'Tues': ['00:00-24:00'], 'Wed': [], 'Thur': [], 'Fri': [],
     'Sat': ['00:00-24:00'],
     'Sun': ['00:00-24:00']},
    {'act_name': '红色猫薄荷', 'Mon': [], 'Tues': [], 'Wed': ['00:00-24:00'], 'Thur': [], 'Fri': [],
     'Sat': ['00:00-24:00'],
     'Sun': ['00:00-24:00']},
    {'act_name': '蓝色猫薄荷', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': ['00:00-24:00'], 'Fri': [],
     'Sat': ['00:00-24:00'],
     'Sun': ['00:00-24:00']},
    {'act_name': '黄色猫薄荷', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': ['00:00-24:00'],
     'Sat': ['00:00-24:00'],
     'Sun': ['00:00-24:00']},

    {'act_name': '彩虹貓薄荷關卡', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': ['11:00-12:00'],
     'Sun': ['18:00-19:00']},
    {'act_name': '古代貓薄荷關卡', 'Mon': ['07:00-08:00'], 'Tues': ['12:00-13:00'], 'Wed': ['19:00-20:00'],
     'Thur': ['07:00-08:00'],
     'Fri': ['12:00-13:00'], 'Sat': ['15:00-16:00', '21:00-22:00'], 'Sun': ['10:00-11:00', '19:00-20:00']},
    {'act_name': '惡貓薄荷關卡', 'Mon': ['12:00-13:00'], 'Tues': ['19:00-20:00'], 'Wed': ['07:00-08:00'],
     'Thur': ['12:00-13:00'],
     'Fri': ['19:00-20:00'], 'Sat': ['10:00-11:00', '19:00-20:00'], 'Sun': ['15:00-16:00', '21:00-22:00']},
    # XP经验关
    {'act_name': '游擊戰經驗值喵！', 'Mon': ['11:00-12:00', '22:00-23:00'], 'Tues': ['08:00-09:00', '19:00-20:00'],
     'Wed': ['13:00-14:00', '21:00-22:00'], 'Thur': ['12:00-13:00', '20:00-21:00'],
     'Fri': ['11:00-12:00', '17:00-18:00'], 'Sat': [], 'Sun': []},
    {'act_name': '超級游擊經驗值喵！', 'Mon': ['12:00-13:00'], 'Tues': ['16:00-17:00'], 'Wed': ['19:00-20:00'],
     'Thur': ['07:00-08:00'],
     'Fri': ['13:00-14:00'], 'Sat': ['11:00-12:00', '23:00-24:00'], 'Sun': ['13:00-14:00', '20:00-21:00']},
    {'act_name': '終極游擊經驗值喵！', 'Mon': ['12:00-13:00'], 'Tues': [], 'Wed': ['15:00-16:00'], 'Thur': [],
     'Fri': ['19:00-20:00'],
     'Sat': ['12:00-13:00', '22:00-23:00'], 'Sun': ['10:00-11:00', '16:00-17:00']},
    {'act_name': '超終極游擊經驗值喵！', 'Mon': [], 'Tues': ['13:00-14:00'], 'Wed': [], 'Thur': ['17:00-18:00'],
     'Fri': [],
     'Sat': ['10:00-11:00'], 'Sun': ['21:00-22:00']},

    {'act_name': '--------------降臨系列關卡----------------'},
    # --- 圖片 1: 降臨系列關卡 (BCA6B4...) ---
    {'act_name': '限定活动-女帝飛來', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [], 'Sun': [],
     'Day_01': ['00:00-24:00'], 'Day_02': ['00:00-24:00'], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [],
     'Day_07': [],
     'Day_08': [], 'Day_09': [], 'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [],
     'Day_15': ['00:00-24:00'], 'Day_16': ['00:00-24:00'], 'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [],
     'Day_21': [], 'Day_22': [], 'Day_23': [], 'Day_24': [], 'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [],
     'Day_29': [], 'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-古王妃飛來', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [], 'Sun': [],
     'Day_01': ['00:00-24:00'], 'Day_02': ['00:00-24:00'], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [],
     'Day_07': [],
     'Day_08': [], 'Day_09': [], 'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [],
     'Day_15': ['00:00-24:00'], 'Day_16': ['00:00-24:00'], 'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [],
     'Day_21': [], 'Day_22': [], 'Day_23': [], 'Day_24': [], 'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [],
     'Day_29': [], 'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-亡者肥普降臨', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [], 'Sun': [],
     'Day_01': [], 'Day_02': [], 'Day_03': ['00:00-24:00'], 'Day_04': ['00:00-24:00'], 'Day_05': [], 'Day_06': [],
     'Day_07': [], 'Day_08': [], 'Day_09': [], 'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [],
     'Day_15': [], 'Day_16': [], 'Day_17': ['00:00-24:00'], 'Day_18': ['00:00-24:00'], 'Day_19': [], 'Day_20': [],
     'Day_21': [], 'Day_22': [], 'Day_23': [], 'Day_24': [], 'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [],
     'Day_29': [], 'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-聖者波普降臨', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [], 'Sun': [],
     'Day_01': [], 'Day_02': [], 'Day_03': ['00:00-24:00'], 'Day_04': ['00:00-24:00'], 'Day_05': [], 'Day_06': [],
     'Day_07': [], 'Day_08': [], 'Day_09': [], 'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [],
     'Day_15': [], 'Day_16': [], 'Day_17': ['00:00-24:00'], 'Day_18': ['00:00-24:00'], 'Day_19': [], 'Day_20': [],
     'Day_21': [], 'Day_22': [], 'Day_23': [], 'Day_24': [], 'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [],
     'Day_29': [], 'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-吉娃娃伯爵降臨', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [],
     'Sun': [],
     'Day_01': [], 'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': ['00:00-24:00'], 'Day_06': ['00:00-24:00'],
     'Day_07': [], 'Day_08': [], 'Day_09': [], 'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [],
     'Day_15': [], 'Day_16': [], 'Day_17': [], 'Day_18': [], 'Day_19': ['00:00-24:00'], 'Day_20': ['00:00-24:00'],
     'Day_21': [], 'Day_22': [], 'Day_23': [], 'Day_24': [], 'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [],
     'Day_29': [], 'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-綺羅星汪汪降臨', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [],
     'Sun': [],
     'Day_01': [], 'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': ['00:00-24:00'], 'Day_06': ['00:00-24:00'],
     'Day_07': [], 'Day_08': [], 'Day_09': [], 'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [],
     'Day_15': [], 'Day_16': [], 'Day_17': [], 'Day_18': [], 'Day_19': ['00:00-24:00'], 'Day_20': ['00:00-24:00'],
     'Day_21': [], 'Day_22': [], 'Day_23': [], 'Day_24': [], 'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [],
     'Day_29': [], 'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-斷罪天使海蝶降臨', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [],
     'Sun': [],
     'Day_01': [], 'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': ['00:00-24:00'],
     'Day_08': ['00:00-24:00'], 'Day_09': [], 'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [],
     'Day_15': [], 'Day_16': [], 'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': ['00:00-24:00'],
     'Day_22': ['00:00-24:00'], 'Day_23': [], 'Day_24': [], 'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [],
     'Day_29': [], 'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-死靈妖精海蝶降臨', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [],
     'Sun': [],
     'Day_01': [], 'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': ['00:00-24:00'],
     'Day_08': ['00:00-24:00'], 'Day_09': [], 'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [],
     'Day_15': [], 'Day_16': [], 'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': ['00:00-24:00'],
     'Day_22': ['00:00-24:00'], 'Day_23': [], 'Day_24': [], 'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [],
     'Day_29': [], 'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-春宵苦短，少女做夢吧！', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [],
     'Sun': [],
     'Day_01': [], 'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [], 'Day_08': [],
     'Day_09': ['00:00-24:00'], 'Day_10': ['00:00-24:00'], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [],
     'Day_15': [], 'Day_16': [], 'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [],
     'Day_23': ['00:00-24:00'], 'Day_24': ['00:00-24:00'], 'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [],
     'Day_29': [], 'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-第一次的差事', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [], 'Sun': [],
     'Day_01': [], 'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [], 'Day_08': [],
     'Day_09': ['00:00-24:00'], 'Day_10': ['00:00-24:00'], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [],
     'Day_15': [], 'Day_16': [], 'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [],
     'Day_23': ['00:00-24:00'], 'Day_24': ['00:00-24:00'], 'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [],
     'Day_29': [], 'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-誘惑的交響曲', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [], 'Sun': [],
     'Day_01': [], 'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [], 'Day_08': [],
     'Day_09': ['00:00-24:00'], 'Day_10': ['00:00-24:00'], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [],
     'Day_15': [], 'Day_16': [], 'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [],
     'Day_23': ['00:00-24:00'], 'Day_24': ['00:00-24:00'], 'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [],
     'Day_29': [], 'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-地獄門', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [], 'Sun': [],
     'Day_01': [],
     'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [], 'Day_08': [], 'Day_09': [],
     'Day_10': [], 'Day_11': ['00:00-24:00'], 'Day_12': ['00:00-24:00'], 'Day_13': [], 'Day_14': [], 'Day_15': [],
     'Day_16': [], 'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [], 'Day_23': [],
     'Day_24': [], 'Day_25': ['00:00-24:00'], 'Day_26': ['00:00-24:00'], 'Day_27': [], 'Day_28': [], 'Day_29': [],
     'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-奈落門', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [], 'Sun': [],
     'Day_01': [],
     'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [], 'Day_08': [], 'Day_09': [],
     'Day_10': [], 'Day_11': ['00:00-24:00'], 'Day_12': ['00:00-24:00'], 'Day_13': [], 'Day_14': [], 'Day_15': [],
     'Day_16': [], 'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [], 'Day_23': [],
     'Day_24': [], 'Day_25': ['00:00-24:00'], 'Day_26': ['00:00-24:00'], 'Day_27': [], 'Day_28': [], 'Day_29': [],
     'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-破滅的序曲', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [], 'Sun': [],
     'Day_01': [],
     'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [], 'Day_08': [], 'Day_09': [],
     'Day_10': [], 'Day_11': ['00:00-24:00'], 'Day_12': ['00:00-24:00'], 'Day_13': [], 'Day_14': [], 'Day_15': [],
     'Day_16': [], 'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [], 'Day_23': [],
     'Day_24': [], 'Day_25': ['00:00-24:00'], 'Day_26': ['00:00-24:00'], 'Day_27': [], 'Day_28': [], 'Day_29': [],
     'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-羅生門', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [], 'Sun': [],
     'Day_01': [],
     'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [], 'Day_08': [], 'Day_09': [],
     'Day_10': [], 'Day_11': ['00:00-24:00'], 'Day_12': ['00:00-24:00'], 'Day_13': [], 'Day_14': [], 'Day_15': [],
     'Day_16': [], 'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [], 'Day_23': [],
     'Day_24': [], 'Day_25': ['00:00-24:00'], 'Day_26': ['00:00-24:00'], 'Day_27': [], 'Day_28': [], 'Day_29': [],
     'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-藍色衝擊', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [], 'Sun': [],
     'Day_01': [],
     'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [], 'Day_08': [], 'Day_09': [],
     'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': ['00:00-24:00'], 'Day_14': ['00:00-24:00'], 'Day_15': [],
     'Day_16': [], 'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [], 'Day_23': [],
     'Day_24': [], 'Day_25': [], 'Day_26': [], 'Day_27': ['00:00-24:00'], 'Day_28': ['00:00-24:00'], 'Day_29': [],
     'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-暗沼幽靈', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [], 'Sun': [],
     'Day_01': [],
     'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [], 'Day_08': [], 'Day_09': [],
     'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': ['00:00-24:00'], 'Day_14': ['00:00-24:00'], 'Day_15': [],
     'Day_16': [], 'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [], 'Day_23': [],
     'Day_24': [], 'Day_25': [], 'Day_26': [], 'Day_27': ['00:00-24:00'], 'Day_28': ['00:00-24:00'], 'Day_29': [],
     'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-三途河澤之主大降臨', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [],
     'Sun': [],
     'Day_01': [], 'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [], 'Day_08': [],
     'Day_09': [], 'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': ['00:00-24:00'], 'Day_14': ['00:00-24:00'],
     'Day_15': [], 'Day_16': [], 'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [],
     'Day_23': [], 'Day_24': [], 'Day_25': [], 'Day_26': [], 'Day_27': ['00:00-24:00'], 'Day_28': ['00:00-24:00'],
     'Day_29': [], 'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-大魔王撒旦大降臨', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [],
     'Sun': [],
     'Day_01': [], 'Day_02': [], 'Day_03': ['00:00-24:00'], 'Day_04': ['00:00-24:00'], 'Day_05': [], 'Day_06': [],
     'Day_07': [], 'Day_08': [], 'Day_09': [], 'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [],
     'Day_15': [], 'Day_16': [], 'Day_17': ['00:00-24:00'], 'Day_18': ['00:00-24:00'], 'Day_19': [], 'Day_20': [],
     'Day_21': [], 'Day_22': [], 'Day_23': [], 'Day_24': [], 'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [],
     'Day_29': [], 'Day_30': [], 'Day_31': []},

    {'act_name': '----------------旋風關卡----------------'},
    # --- 圖片 2: 旋風關卡 (A0639...) ---
    {'act_name': '限定活动-紅色突變', 'Mon': ['00:00-24:00'], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [],
     'Sun': [],
     'Day_01': [], 'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [], 'Day_08': [],
     'Day_09': [], 'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [], 'Day_15': [], 'Day_16': [],
     'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [], 'Day_23': [], 'Day_24': [],
     'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [], 'Day_29': [], 'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-緊急暴風警報', 'Mon': [], 'Tues': ['00:00-24:00'], 'Wed': [], 'Thur': [], 'Fri': [],
     'Sat': [], 'Sun': [],
     'Day_01': [], 'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [], 'Day_08': [],
     'Day_09': [], 'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [], 'Day_15': [], 'Day_16': [],
     'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [], 'Day_23': [], 'Day_24': [],
     'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [], 'Day_29': [], 'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-滾死樂園', 'Mon': [], 'Tues': ['00:00-24:00'], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [],
     'Sun': [],
     'Day_01': [], 'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [], 'Day_08': [],
     'Day_09': [], 'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [], 'Day_15': [], 'Day_16': [],
     'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [], 'Day_23': [], 'Day_24': [],
     'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [], 'Day_29': [], 'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-黑暗天堂', 'Mon': [], 'Tues': [], 'Wed': ['00:00-24:00'], 'Thur': [], 'Fri': [], 'Sat': [],
     'Sun': [],
     'Day_01': [], 'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [], 'Day_08': [],
     'Day_09': [], 'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [], 'Day_15': [], 'Day_16': [],
     'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [], 'Day_23': [], 'Day_24': [],
     'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [], 'Day_29': [], 'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-絕望異次元', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': ['00:00-24:00'], 'Fri': [], 'Sat': [],
     'Sun': [],
     'Day_01': [], 'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [], 'Day_08': [],
     'Day_09': [], 'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [], 'Day_15': [], 'Day_16': [],
     'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [], 'Day_23': [], 'Day_24': [],
     'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [], 'Day_29': [], 'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-國士無雙', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': ['00:00-24:00'], 'Sat': [],
     'Sun': [],
     'Day_01': [], 'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [], 'Day_08': [],
     'Day_09': [], 'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [], 'Day_15': [], 'Day_16': [],
     'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [], 'Day_23': [], 'Day_24': [],
     'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [], 'Day_29': [], 'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-大魔王', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': ['00:00-24:00'], 'Sat': [],
     'Sun': [],
     'Day_01': [], 'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [], 'Day_08': [],
     'Day_09': [], 'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [], 'Day_15': [], 'Day_16': [],
     'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [], 'Day_23': [], 'Day_24': [],
     'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [], 'Day_29': [], 'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-天譴', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': ['00:00-24:00'],
     'Sun': [],
     'Day_01': [], 'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [], 'Day_08': [],
     'Day_09': [], 'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [], 'Day_15': [], 'Day_16': [],
     'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [], 'Day_23': [], 'Day_24': [],
     'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [], 'Day_29': [], 'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-零號颱風', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': ['00:00-24:00'],
     'Sun': [],
     'Day_01': [], 'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [], 'Day_08': [],
     'Day_09': [], 'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [], 'Day_15': [], 'Day_16': [],
     'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [], 'Day_23': [], 'Day_24': [],
     'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [], 'Day_29': [], 'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-鐵子的部屋', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [],
     'Sun': ['00:00-24:00'],
     'Day_01': [], 'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [], 'Day_08': [],
     'Day_09': [], 'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [], 'Day_15': [], 'Day_16': [],
     'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [], 'Day_23': [], 'Day_24': [],
     'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [], 'Day_29': [], 'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-絕望新次元', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [],
     'Sun': ['00:00-24:00'],
     'Day_01': [], 'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [], 'Day_08': [],
     'Day_09': [], 'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [], 'Day_15': [], 'Day_16': [],
     'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [], 'Day_23': [], 'Day_24': [],
     'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [], 'Day_29': [], 'Day_30': [], 'Day_31': []},

    {'act_name': '---------狂亂/小小/洗腦系列關卡----------------'},
    # --- 圖片 3: 狂亂/小小/洗腦系列 (12ABC...) ---
    {'act_name': '限定活动-狂亂家族大亂鬥', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [],
     'Sun': [],
     'Day_01': ['00:00-24:00'], 'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [],
     'Day_08': [], 'Day_09': [], 'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [], 'Day_15': [],
     'Day_16': [], 'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [], 'Day_23': [],
     'Day_24': [], 'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [], 'Day_29': [], 'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-极恶家族大亂鬥', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [],
     'Sun': [],
     'Day_01': [], 'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [],
     'Day_08': [], 'Day_09': [], 'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [], 'Day_15': [],
     'Day_16': ['00:00-24:00'], 'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [],
     'Day_23': [],
     'Day_24': [], 'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [], 'Day_29': [], 'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-狂亂貓', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [], 'Sun': [],
     'Day_01': [],
     'Day_02': [], 'Day_03': ['00:00-24:00'], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [], 'Day_08': [],
     'Day_09': [], 'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [], 'Day_15': [], 'Day_16': [],
     'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [], 'Day_23': [], 'Day_24': [],
     'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [], 'Day_29': [], 'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-小小貓', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [], 'Sun': [],
     'Day_01': [],
     'Day_02': ['00:00-24:00'], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [], 'Day_08': [],
     'Day_09': [], 'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [], 'Day_15': [], 'Day_16': [],
     'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [], 'Day_23': [], 'Day_24': [],
     'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [], 'Day_29': [], 'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-洗脑貓', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [], 'Sun': [],
     'Day_01': [],
     'Day_02': [], 'Day_03': ['00:00-24:00'], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [], 'Day_08': [],
     'Day_09': [], 'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [], 'Day_15': [], 'Day_16': [],
     'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [], 'Day_23': [], 'Day_24': [],
     'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [], 'Day_29': [], 'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-狂亂坦克貓', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [], 'Sun': [],
     'Day_01': [],
     'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': ['00:00-24:00'], 'Day_07': [], 'Day_08': [],
     'Day_09': [], 'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [], 'Day_15': [], 'Day_16': [],
     'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [], 'Day_23': [], 'Day_24': [],
     'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [], 'Day_29': [], 'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-小小坦克貓', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [], 'Sun': [],
     'Day_01': [],
     'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': ['00:00-24:00'], 'Day_06': [], 'Day_07': [], 'Day_08': [],
     'Day_09': [], 'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [], 'Day_15': [], 'Day_16': [],
     'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [], 'Day_23': [], 'Day_24': [],
     'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [], 'Day_29': [], 'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-洗脑坦克貓', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [], 'Sun': [],
     'Day_01': [],
     'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': ['00:00-24:00'], 'Day_07': [], 'Day_08': [],
     'Day_09': [], 'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [], 'Day_15': [], 'Day_16': [],
     'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [], 'Day_23': [], 'Day_24': [],
     'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [], 'Day_29': [], 'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-狂亂战斗貓', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [], 'Sun': [],
     'Day_01': [],
     'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [], 'Day_08': [],
     'Day_09': ['00:00-24:00'], 'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [], 'Day_15': [],
     'Day_16': [],
     'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [], 'Day_23': [], 'Day_24': [],
     'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [], 'Day_29': [], 'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-小小战斗貓', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [], 'Sun': [],
     'Day_01': [],
     'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [], 'Day_08': ['00:00-24:00'],
     'Day_09': [], 'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [], 'Day_15': [], 'Day_16': [],
     'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [], 'Day_23': [], 'Day_24': [],
     'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [], 'Day_29': [], 'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-洗脑战斗貓', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [], 'Sun': [],
     'Day_01': [],
     'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [], 'Day_08': [],
     'Day_09': ['00:00-24:00'], 'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [], 'Day_15': [],
     'Day_16': [],
     'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [], 'Day_23': [], 'Day_24': [],
     'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [], 'Day_29': [], 'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-狂亂恶心貓', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [], 'Sun': [],
     'Day_01': [],
     'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [], 'Day_08': [],
     'Day_09': [], 'Day_10': [], 'Day_11': [], 'Day_12': ['00:00-24:00'], 'Day_13': [], 'Day_14': [], 'Day_15': [],
     'Day_16': [],
     'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [], 'Day_23': [], 'Day_24': [],
     'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [], 'Day_29': [], 'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-小小恶心貓', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [], 'Sun': [],
     'Day_01': [],
     'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [], 'Day_08': [],
     'Day_09': [], 'Day_10': [], 'Day_11': ['00:00-24:00'], 'Day_12': [], 'Day_13': [], 'Day_14': [], 'Day_15': [],
     'Day_16': [],
     'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [], 'Day_23': [], 'Day_24': [],
     'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [], 'Day_29': [], 'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-洗脑恶心貓', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [], 'Sun': [],
     'Day_01': [],
     'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [], 'Day_08': [],
     'Day_09': [], 'Day_10': [], 'Day_11': [], 'Day_12': ['00:00-24:00'], 'Day_13': [], 'Day_14': [], 'Day_15': [],
     'Day_16': [],
     'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [], 'Day_23': [], 'Day_24': [],
     'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [], 'Day_29': [], 'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-狂亂狮子貓', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [], 'Sun': [],
     'Day_01': [],
     'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [], 'Day_08': [],
     'Day_09': [], 'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [], 'Day_15': ['00:00-24:00'],
     'Day_16': [],
     'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [], 'Day_23': [], 'Day_24': [],
     'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [], 'Day_29': [], 'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-小小狮子貓', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [], 'Sun': [],
     'Day_01': [],
     'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [], 'Day_08': [],
     'Day_09': [], 'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': ['00:00-24:00'], 'Day_15': [],
     'Day_16': [],
     'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [], 'Day_23': [], 'Day_24': [],
     'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [], 'Day_29': [], 'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-洗脑狮子貓', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [], 'Sun': [],
     'Day_01': [],
     'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [], 'Day_08': [],
     'Day_09': [], 'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [], 'Day_15': ['00:00-24:00'],
     'Day_16': [],
     'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [], 'Day_23': [], 'Day_24': [],
     'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [], 'Day_29': [], 'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-狂亂鸟貓', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [], 'Sun': [],
     'Day_01': [],
     'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [], 'Day_08': [],
     'Day_09': [], 'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [], 'Day_15': [], 'Day_16': [],
     'Day_17': [], 'Day_18': ['00:00-24:00'], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [], 'Day_23': [],
     'Day_24': [],
     'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [], 'Day_29': [], 'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-小小鸟貓', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [], 'Sun': [],
     'Day_01': [],
     'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [], 'Day_08': [],
     'Day_09': [], 'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [], 'Day_15': [], 'Day_16': [],
     'Day_17': ['00:00-24:00'], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [], 'Day_23': [],
     'Day_24': [],
     'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [], 'Day_29': [], 'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-洗脑鸟貓', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [], 'Sun': [],
     'Day_01': [],
     'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [], 'Day_08': [],
     'Day_09': [], 'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [], 'Day_15': [], 'Day_16': [],
     'Day_17': [], 'Day_18': ['00:00-24:00'], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [], 'Day_23': [],
     'Day_24': [],
     'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [], 'Day_29': [], 'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-狂亂鱼貓', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [], 'Sun': [],
     'Day_01': [],
     'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [], 'Day_08': [],
     'Day_09': [], 'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [], 'Day_15': [], 'Day_16': [],
     'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': ['00:00-24:00'], 'Day_22': [], 'Day_23': [],
     'Day_24': [],
     'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [], 'Day_29': [], 'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-小小鱼貓', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [], 'Sun': [],
     'Day_01': [],
     'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [], 'Day_08': [],
     'Day_09': [], 'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [], 'Day_15': [], 'Day_16': [],
     'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': ['00:00-24:00'], 'Day_21': [], 'Day_22': [], 'Day_23': [],
     'Day_24': [],
     'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [], 'Day_29': [], 'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-洗脑鱼貓', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [], 'Sun': [],
     'Day_01': [],
     'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [], 'Day_08': [],
     'Day_09': [], 'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [], 'Day_15': [], 'Day_16': [],
     'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': ['00:00-24:00'], 'Day_22': [], 'Day_23': [],
     'Day_24': [],
     'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [], 'Day_29': [], 'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-狂亂蜥蜴貓', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [], 'Sun': [],
     'Day_01': [],
     'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [], 'Day_08': [],
     'Day_09': [], 'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [], 'Day_15': [], 'Day_16': [],
     'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [], 'Day_23': [],
     'Day_24': ['00:00-24:00'],
     'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [], 'Day_29': [], 'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-小小蜥蜴貓', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [], 'Sun': [],
     'Day_01': [],
     'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [], 'Day_08': [],
     'Day_09': [], 'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [], 'Day_15': [], 'Day_16': [],
     'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [], 'Day_23': ['00:00-24:00'],
     'Day_24': [],
     'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [], 'Day_29': [], 'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-洗脑蜥蜴貓', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [], 'Sun': [],
     'Day_01': [],
     'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [], 'Day_08': [],
     'Day_09': [], 'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [], 'Day_15': [], 'Day_16': [],
     'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [], 'Day_23': [],
     'Day_24': ['00:00-24:00'],
     'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [], 'Day_29': [], 'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-狂亂巨神貓', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [], 'Sun': [],
     'Day_01': [],
     'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [], 'Day_08': [],
     'Day_09': [], 'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [], 'Day_15': [], 'Day_16': [],
     'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [], 'Day_23': [], 'Day_24': [],
     'Day_25': [], 'Day_26': [], 'Day_27': ['00:00-24:00'], 'Day_28': [], 'Day_29': [], 'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-小小巨神貓', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [], 'Sun': [],
     'Day_01': [],
     'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [], 'Day_08': [],
     'Day_09': [], 'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [], 'Day_15': [], 'Day_16': [],
     'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [], 'Day_23': [], 'Day_24': [],
     'Day_25': [], 'Day_26': ['00:00-24:00'], 'Day_27': [], 'Day_28': [], 'Day_29': [], 'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-洗脑巨神貓', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [], 'Sun': [],
     'Day_01': [],
     'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [], 'Day_08': [],
     'Day_09': [], 'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [], 'Day_15': [], 'Day_16': [],
     'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [], 'Day_23': [], 'Day_24': [],
     'Day_25': [], 'Day_26': [], 'Day_27': ['00:00-24:00'], 'Day_28': [], 'Day_29': [], 'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-狂亂萌萌貓', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [], 'Sun': [],
     'Day_01': [],
     'Day_02': [], 'Day_03': ['00:00-24:00'], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [], 'Day_08': [],
     'Day_09': [], 'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [], 'Day_15': [], 'Day_16': [],
     'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [], 'Day_23': [], 'Day_24': [],
     'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [], 'Day_29': [], 'Day_30': [], 'Day_31': []},

    {'act_name': '--------------開眼EX關卡----------------'},
    # --- 圖片 4: 開眼EX關卡 (Image_176...) ---
    {'act_name': '限定活动-女王貓', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [], 'Sun': [],
     'Day_01': ['07:00-14:00'], 'Day_02': ['17:00-24:00'], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [],
     'Day_07': [], 'Day_08': [], 'Day_09': [], 'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [],
     'Day_15': [], 'Day_16': [], 'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [],
     'Day_23': [], 'Day_24': [], 'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [], 'Day_29': [], 'Day_30': [],
     'Day_31': []},
    {'act_name': '限定活动-三角褲貓', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [], 'Sun': [],
     'Day_01': [],
     'Day_02': [], 'Day_03': ['07:00-14:00'], 'Day_04': ['17:00-24:00'], 'Day_05': [], 'Day_06': [], 'Day_07': [],
     'Day_08': [], 'Day_09': [], 'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [], 'Day_15': [],
     'Day_16': [], 'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [], 'Day_23': [],
     'Day_24': [], 'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [], 'Day_29': [], 'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-功夫貓', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [], 'Sun': [],
     'Day_01': [],
     'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': ['07:00-14:00'], 'Day_06': ['17:00-24:00'], 'Day_07': [],
     'Day_08': [], 'Day_09': [], 'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [], 'Day_15': [],
     'Day_16': [], 'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [], 'Day_23': [],
     'Day_24': [], 'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [], 'Day_29': [], 'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-緊縛貓', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [], 'Sun': [],
     'Day_01': [],
     'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': ['07:00-14:00'],
     'Day_08': ['17:00-24:00'], 'Day_09': [], 'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [],
     'Day_15': [], 'Day_16': [], 'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [],
     'Day_23': [], 'Day_24': [], 'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [], 'Day_29': [], 'Day_30': [],
     'Day_31': []},
    {'act_name': '限定活动-殭屍貓', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [], 'Sun': [],
     'Day_01': [],
     'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [], 'Day_08': [],
     'Day_09': ['07:00-14:00'], 'Day_10': ['17:00-24:00'], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [],
     'Day_15': [], 'Day_16': [], 'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [],
     'Day_23': [], 'Day_24': [], 'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [], 'Day_29': [], 'Day_30': [],
     'Day_31': []},
    {'act_name': '限定活动-狂歡貓', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [], 'Sun': [],
     'Day_01': [],
     'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [], 'Day_08': [], 'Day_09': [],
     'Day_10': [], 'Day_11': ['07:00-14:00'], 'Day_12': ['17:00-24:00'], 'Day_13': [], 'Day_14': [], 'Day_15': [],
     'Day_16': [], 'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [], 'Day_23': [],
     'Day_24': [], 'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [], 'Day_29': [], 'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-武士貓', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [], 'Sun': [],
     'Day_01': [],
     'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [], 'Day_08': [], 'Day_09': [],
     'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': ['07:00-14:00'], 'Day_14': ['17:00-24:00'], 'Day_15': [],
     'Day_16': [], 'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [], 'Day_23': [],
     'Day_24': [], 'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [], 'Day_29': [], 'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-箱貓', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [], 'Sun': [],
     'Day_01': [],
     'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [], 'Day_08': [], 'Day_09': [],
     'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [], 'Day_15': ['07:00-14:00'],
     'Day_16': ['17:00-24:00'], 'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [],
     'Day_23': [], 'Day_24': [], 'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [], 'Day_29': [], 'Day_30': [],
     'Day_31': []},
    {'act_name': '限定活动-忍者貓', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [], 'Sun': [],
     'Day_01': [],
     'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [], 'Day_08': [], 'Day_09': [],
     'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [], 'Day_15': [], 'Day_16': [],
     'Day_17': ['07:00-14:00'], 'Day_18': ['17:00-24:00'], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [],
     'Day_23': [], 'Day_24': [], 'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [], 'Day_29': [], 'Day_30': [],
     'Day_31': []},
    {'act_name': '限定活动-Mr.', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [], 'Sun': [],
     'Day_01': [],
     'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [], 'Day_08': [], 'Day_09': [],
     'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [], 'Day_15': [], 'Day_16': [], 'Day_17': [],
     'Day_18': [], 'Day_19': ['07:00-14:00'], 'Day_20': ['17:00-24:00'], 'Day_21': [], 'Day_22': [], 'Day_23': [],
     'Day_24': [], 'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [], 'Day_29': [], 'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-輪輪貓', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [], 'Sun': [],
     'Day_01': [],
     'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [], 'Day_08': [], 'Day_09': [],
     'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [], 'Day_15': [], 'Day_16': [], 'Day_17': [],
     'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': ['07:00-14:00'], 'Day_22': ['17:00-24:00'], 'Day_23': [],
     'Day_24': [], 'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [], 'Day_29': [], 'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-短裙貓', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [], 'Sun': [],
     'Day_01': [],
     'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [], 'Day_08': [], 'Day_09': [],
     'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [], 'Day_15': [], 'Day_16': [], 'Day_17': [],
     'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [], 'Day_23': ['07:00-14:00'],
     'Day_24': ['17:00-24:00'], 'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [], 'Day_29': [], 'Day_30': [],
     'Day_31': []},
    {'act_name': '限定活动-相撲貓', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [], 'Sun': [],
     'Day_01': [],
     'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [], 'Day_08': [], 'Day_09': [],
     'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [], 'Day_15': [], 'Day_16': [], 'Day_17': [],
     'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [], 'Day_23': [], 'Day_24': [],
     'Day_25': ['07:00-14:00'], 'Day_26': ['17:00-24:00'], 'Day_27': [], 'Day_28': [], 'Day_29': [], 'Day_30': [],
     'Day_31': []},
    {'act_name': '限定活动-女優貓', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [], 'Sun': [],
     'Day_01': [],
     'Day_02': [], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [], 'Day_08': [], 'Day_09': [],
     'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [], 'Day_15': [], 'Day_16': [], 'Day_17': [],
     'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': [], 'Day_23': [], 'Day_24': [], 'Day_25': [],
     'Day_26': [], 'Day_27': ['07:00-14:00'], 'Day_28': ['17:00-24:00'], 'Day_29': [], 'Day_30': [], 'Day_31': []},
    {'act_name': '限定活动-開眼花盆猫(未來三)', 'Mon': [], 'Tues': [], 'Wed': [], 'Thur': [], 'Fri': [], 'Sat': [],
     'Sun': [],
     'Day_01': [], 'Day_02': ['14:22-14:24'], 'Day_03': [], 'Day_04': [], 'Day_05': [], 'Day_06': [], 'Day_07': [],
     'Day_08': [], 'Day_09': [], 'Day_10': [], 'Day_11': [], 'Day_12': [], 'Day_13': [], 'Day_14': [], 'Day_15': [],
     'Day_16': [], 'Day_17': [], 'Day_18': [], 'Day_19': [], 'Day_20': [], 'Day_21': [], 'Day_22': ['14:22-14:24'],
     'Day_23': [], 'Day_24': [], 'Day_25': [], 'Day_26': [], 'Day_27': [], 'Day_28': [], 'Day_29': [], 'Day_30': [],
     'Day_31': []}
]

########################################################################################################################
###########
# 时区常量 #
###########
TIMEZONE_KEYS = [
    # --- 西半球 (UTC-) ---
    'Etc/GMT+12',  # -12:00
    'Etc/GMT+11',  # -11:00
    'Etc/GMT+10',  # -10:00
    'Etc/GMT+9',  # -09:00
    'Etc/GMT+8',  # -08:00
    'Etc/GMT+7',  # -07:00
    'Etc/GMT+6',  # -06:00
    'Etc/GMT+5',  # -05:00
    'Etc/GMT+4',  # -04:00
    'Etc/GMT+3',  # -03:00
    'Etc/GMT+2',  # -02:00
    'Etc/GMT+1',  # -01:00

    # --- UTC 0 ---
    'Etc/GMT',  # +00:00

    # --- 东半球 (UTC+) ---
    'Etc/GMT-1',  # +01:00
    'Etc/GMT-2',  # +02:00
    'Etc/GMT-3',  # +03:00
    'Etc/GMT-4',  # +04:00
    'Etc/GMT-5',  # +05:00
    'Etc/GMT-6',  # +06:00
    'Etc/GMT-7',  # +07:00
    'Etc/GMT-8',  # +08:00
    'Etc/GMT-9',  # +09:00
    'Etc/GMT-10',  # +10:00
    'Etc/GMT-11',  # +11:00
    'Etc/GMT-12',  # +12:00
    'Etc/GMT-13',  # +13:00
    'Etc/GMT-14',  # +14:00
]
g_original_timezone = "Asia/Shanghai"


def resource_path(relative_path):
    """
    获取资源的绝对路径，终极健壮版。
    融合了项目原有结构和对部署环境的兼容性。
    """
    try:
        # PyInstaller 的 --onefile 模式会创建一个临时文件夹
        # 并将路径存储在 sys._MEIPASS
        base_path = sys._MEIPASS
    except Exception:
        # 未打包（开发环境）或 --onedir 模式
        if getattr(sys, 'frozen', False):
            # 在 --onedir 模式下打包后，基路径是可执行文件所在的目录
            base_path = os.path.dirname(sys.executable)
        else:
            # 在开发环境中，使用你原来的逻辑，这非常健壮
            # 假设此函数在项目子目录中（如 common/utils.py）
            # __file__ 是当前文件的路径
            current_dir = os.path.dirname(__file__)
            # os.path.join(current_dir, '..') 返回到上一级，即项目根目录
            base_path = os.path.abspath(os.path.join(current_dir, '..'))

    final_path = os.path.join(base_path, relative_path)
    return final_path


def start_appium():
    if getattr(sys, 'frozen', False):
        log_output_dir = os.path.dirname(sys.executable)
    else:
        log_output_dir = resource_path('')

    diag_log_path = os.path.join(log_output_dir, 'python_diag_log.txt')

    def write_diag_log(message):
        with open(diag_log_path, 'a', encoding='utf-8') as f:
            f.write(f"[{datetime.now()}] {message}\n")

    try:
        write_diag_log("--- New start_appium call ---")
        write_diag_log("Attempting to stop any existing Appium server...")
        stop_command = "for /f \"tokens=5\" %a in ('netstat -aon ^| findstr \":4723\"') do taskkill /F /PID %a"
        subprocess.run(stop_command, shell=True, capture_output=True)
        write_diag_log("Stop command executed.")
        portable_appium_dir = resource_path('PortableAppium')
        starter_bat_path = os.path.join(portable_appium_dir, 'start_appium.bat')
        write_diag_log(f"Calculated script path: {starter_bat_path}")
        if not os.path.exists(starter_bat_path):
            write_diag_log("FATAL: Starter script not found.")
            return False
        flags = subprocess.CREATE_NEW_CONSOLE
        write_diag_log(f"Executing Popen with creationflags={flags} to show console.")
        subprocess.Popen([starter_bat_path], cwd=portable_appium_dir, creationflags=flags)
        write_diag_log("Popen command to start Appium with a new console has been sent.")
        return True
    except Exception as e:
        error_message = f"FATAL EXCEPTION in start_appium: {e}\n{traceback.format_exc()}"
        write_diag_log(error_message)
        return False


def stop_appium(logger=print):
    logger("准备终止 Appium 服务...")
    command = "for /f \"tokens=5\" %a in ('netstat -aon ^| findstr \":4723\"') do taskkill /F /PID %a"
    result_code = os.system(command)
    if result_code == 0:
        logger("成功终止了 Appium 服务进程。")
    else:
        logger("终止 Appium 命令已执行。如果服务仍在运行，请手动关闭。可能服务并未启动。")


def close_app(driver, package_name, logger=print):
    try:
        logger(f"正在尝试关闭应用: {package_name}")
        state = driver.query_app_state(package_name)
        if state > 0:
            driver.terminate_app(package_name)
            logger(f"应用 {package_name} 已成功关闭。")
            return True
        else:
            logger(f"应用 {package_name} 未在运行，无需关闭。")
            return True
    except Exception as e:
        logger(f"关闭应用 {package_name} 时发生错误: {e}")
        return False


def start_app(driver, package_name, logger=print):
    try:
        logger(f"正在尝试启动/激活应用: {package_name}")
        driver.activate_app(package_name)
        logger(f"应用 {package_name} 已成功启动/激活。")
        return True
    except Exception as e:
        logger(f"启动应用 {package_name} 时发生错误: {e}")
        return False


# --- ADB 相关函数 ---
def run_adb_command(adb_path, device_serial, command, return_binary=False):
    """
    执行一条ADB命令并返回输出。
    :param adb_path: adb.exe路径
    :param device_serial: 设备序列号
    :param command: 要执行的命令
    :param return_binary: 如果为True，则返回原始二进制输出；否则返回解码后的文本
    :return: 命令输出
    """
    if device_serial is None and "connect" not in command:
        full_command = f"\"{adb_path}\" {command}"
    elif "connect" in command:
        full_command = f"\"{adb_path}\" {command}"
    else:
        full_command = f"\"{adb_path}\" -s {device_serial} {command}"

    adb_directory = os.path.dirname(adb_path)
    try:
        result = subprocess.run(
            full_command,
            shell=True,
            check=True,
            capture_output=True,
            cwd=adb_directory
        )
        if return_binary:
            return result.stdout
        # 兼容Windows的换行符
        return result.stdout.decode('utf-8', errors='ignore').strip().replace('\r\n', '\n')
    except subprocess.CalledProcessError as e:
        error_output = e.stderr.decode('utf-8', errors='ignore').strip()
        if DEBUG:
            print(f"ADB命令执行失败: {command}\n错误: {error_output}")
    except Exception as e:
        if DEBUG:
            print(f"执行ADB命令时发生未知错误: {e}")
    return None


def adb_tap(x, y, adb_path, device_serial):
    """【新增】使用ADB命令模拟点击屏幕指定坐标。"""
    run_adb_command(adb_path, device_serial, f"shell input tap {x} {y}")


def adb_swipe(x1, y1, x2, y2, duration_ms, adb_path, device_serial):
    """使用ADB命令模拟滑动屏幕。"""
    run_adb_command(adb_path, device_serial, f"shell input swipe {x1} {y1} {x2} {y2} {duration_ms}")


def adb_press_and_release(x, y, adb_path, device_serial, press_time_ms=50):
    """
    使用一个极短距离和时间的swipe来模拟一次更可靠的点击（长按）。
    这在某些游戏中比 `tap` 更稳定。
    """
    # 在原坐标点附近一个像素进行滑动，避免被识别为滑动操作
    run_adb_command(adb_path, device_serial, f"shell input swipe {x} {y} {x} {y} {press_time_ms}")


def get_adb_screenshot(adb_path, device_serial):
    """【核心修改】使用ADB从底层获取屏幕截图，并以OpenCV格式返回。"""
    try:
        # -p 表示输出PNG格式的二进制数据
        png_data = run_adb_command(adb_path, device_serial, "shell screencap -p", return_binary=True)
        if not png_data:
            if DEBUG:
                print("错误：通过ADB获取截图失败，没有返回数据。")
            return None

        # 将二进制数据在内存中解码为OpenCV图像对象
        # 注意：Windows ADB的screencap输出可能包含\r\n，需要替换为\n
        png_data_cleaned = png_data.replace(b'\r\n', b'\n')
        image = cv2.imdecode(np.frombuffer(png_data_cleaned, np.uint8), cv2.IMREAD_COLOR)
        return image
    except Exception as e:
        if DEBUG:
            print(f"处理ADB截图时发生错误: {e}")
        return None


g_template_cache = {}


def fast_find_template(haystack_frame, template_name, image_folder, is_legend=False, confidence_threshold=0.8):
    """
    【性能优化版】
    在给定的 `haystack_frame` 中查找模板。
    核心优化：所有匹配操作都在灰度空间进行，大幅提升速度。
    """
    global g_template_cache

    if haystack_frame is None:
        return None

    # 1. 定义 ROIS 坐标系的基准分辨率 (逻辑不变)
    BASE_WIDTH = 1920.0
    BASE_HEIGHT = 1080.0

    # 2. 获取当前截图的实际分辨率 (逻辑不变)
    actual_height, actual_width = haystack_frame.shape[:2]

    # 3. 计算缩放比例 (逻辑不变)
    scale_x = actual_width / BASE_WIDTH
    scale_y = actual_height / BASE_HEIGHT

    template_key = f"{image_folder}_{template_name}_{is_legend}_gray"

    if template_key not in g_template_cache:
        try:
            relative_folder = os.path.join(image_folder, 'legend') if is_legend else image_folder
            relative_path = os.path.join(relative_folder, f"{template_name}.png")
            template_path = resource_path(relative_path)

            template_raw = cv2.imread(template_path, cv2.IMREAD_UNCHANGED)
            if template_raw is None:
                if DEBUG: print(f"[错误] 无法加载模板: {template_path}")
                g_template_cache[template_key] = None
                return None

            mask = None
            # 【核心优化 2】在加载模板时，直接将其转换为灰度图进行缓存
            if template_raw.shape[2] == 4:
                mask = template_raw[:, :, 3]
                template_color = cv2.cvtColor(template_raw, cv2.COLOR_BGRA2BGR)
                template_gray = cv2.cvtColor(template_color, cv2.COLOR_BGR2GRAY)
            else:
                template_gray = cv2.cvtColor(template_raw, cv2.COLOR_BGR2GRAY)

            # 缓存灰度模板和可能的遮罩
            g_template_cache[template_key] = (template_gray, mask)

        except Exception as e:
            if DEBUG: print(f"[错误] 加载模板 {template_name} 失败: {e}")
            g_template_cache[template_key] = None
            return None

    cached_data = g_template_cache[template_key]
    if cached_data is None: return None

    template, mask = cached_data
    if template is None: return None

    template_h, template_w = template.shape[:2]

    # 【核心优化 3】在进行匹配前，将实时截图（大图）也转换为灰度图
    haystack_gray = cv2.cvtColor(haystack_frame, cv2.COLOR_BGR2GRAY)

    # 确定搜索区域 (ROI) (逻辑不变)
    ROIS = ROIS_tw if "tw" in image_folder else ROIS_jp
    screen_to_search = haystack_gray  # 从灰度图中截取ROI
    offset_x, offset_y = 0, 0

    if template_name in ROIS:
        original_roi = ROIS[template_name]
        x, y, w, h = original_roi

        scaled_x = int(x * scale_x)
        scaled_y = int(y * scale_y)
        scaled_w = int(w * scale_x)
        scaled_h = int(h * scale_y)

        x1, y1 = max(0, scaled_x), max(0, scaled_y)
        x2, y2 = min(actual_width, scaled_x + scaled_w), min(actual_height, scaled_y + scaled_h)

        if x2 <= x1 or y2 <= y1: return None

        screen_to_search = haystack_gray[y1:y2, x1:x2]  # 在灰度图上裁剪
        offset_x, offset_y = x1, y1

#######################################################################################################################
        if DEBUG:
            # 调试代码保持不变，现在它会显示正确的裁剪区域
            if template_name == debug_img:
                try:
                    debug_path = "D:\\STMZ_app\\debug_images"
                    if not os.path.exists(debug_path):
                        os.makedirs(debug_path)
                    cv2.imwrite(os.path.join(debug_path, "DEBUG_01_HAYSTACK_FULL.png"), haystack_frame)
                    if template is not None:
                        cv2.imwrite(os.path.join(debug_path, "DEBUG_02_TEMPLATE_YES.png"), template)
                    if mask is not None:
                        cv2.imwrite(os.path.join(debug_path, "DEBUG_03_TEMPLATE_MASK.png"), mask)
                    if screen_to_search is not None:
                        cv2.imwrite(os.path.join(debug_path, "DEBUG_04_HAYSTACK_ROI.png"), screen_to_search)
                    print(f"--- 调试图像已保存至 {debug_path} ---")
                except Exception as e:
                    print(f"!!! 保存调试图像时出错: {e} !!!")
#######################################################################################################################

    # 【核心优化 4】现在是在灰度图上进行模板匹配，速度极快
    res = cv2.matchTemplate(screen_to_search, template, cv2.TM_CCOEFF_NORMED, mask=mask)
    min_val, max_val, min_loc, max_loc = cv2.minMaxLoc(res)

    if not np.isfinite(max_val): max_val = 0.0

    if DEBUG:
        print(f"DEBUG: 快速查找(灰度) '{template_name}'，最高匹配度: {max_val:.4f}")

    if max_val >= confidence_threshold:
        # 计算坐标的逻辑完全不变
        center_x = max_loc[0] + offset_x + template_w // 2
        center_y = max_loc[1] + offset_y + template_h // 2
        return center_x, center_y

    return None


# --- 图像识别相关函数 ---
def ordered_fight_strategy(position_order):
    return [positions_to_click[pos] for pos in position_order]


def if_image_on_screen(adb_path, device_serial, template_name, image_folder, confidence_threshold=0.8, is_legend=False):
    """检查指定模板图片是否在当前屏幕上，并返回中心坐标。"""
    try:
        # 1. 构建相对路径
        relative_folder = os.path.join(image_folder, 'legend') if is_legend else image_folder
        relative_path = os.path.join(relative_folder, f"{template_name}.png")

        template_path = resource_path(relative_path)

        if not os.path.exists(template_path):
            # 为了调试，我们打印相对路径和绝对路径
            if DEBUG:
                print(f"[ERROR] 模板图片未找到。相对路径: '{relative_path}', 解析后路径: '{template_path}'")
            return False

        template_raw = cv2.imread(template_path, cv2.IMREAD_UNCHANGED)
        if template_raw is None:
            if DEBUG:
                print(f"[ERROR] 无法读取模板图片: {template_path}")
            return False

        mask = None
        # 检查图片是否有4个通道 (BGRA)
        if template_raw.shape[2] == 4:
            mask = template_raw[:, :, 3]  # Alpha通道作为mask
            template = cv2.cvtColor(template_raw, cv2.COLOR_BGRA2BGR)  # 转换为3通道进行匹配
        else:
            template = template_raw  # 如果是3通道或1通道，直接使用

        template_h, template_w = template.shape[:2]

        # 2. 获取截图
        screen_cv = get_adb_screenshot(adb_path, device_serial)
        if screen_cv is None:
            return False

        # 3. 确定搜索区域 (ROI)
        roi = None
        ROIS = ROIS_tw if "tw" in image_folder else ROIS_jp

        screen_to_search = screen_cv
        offset_x, offset_y = 0, 0
        if template_name in ROIS:
            roi = ROIS[template_name]
            x, y, w, h = roi
            screen_to_search = screen_cv[y:y + h, x:x + w]
            offset_x, offset_y = x, y

        # 4. 模板匹配
        res = cv2.matchTemplate(screen_to_search, template, cv2.TM_CCOEFF_NORMED, mask=mask)
        min_val, max_val, min_loc, max_loc = cv2.minMaxLoc(res)

        # 检查max_val是否为有效数字，防止nan或inf
        if not np.isfinite(max_val):
            max_val = 0.0  # 将无效值视为匹配失败

        if DEBUG:
            print(f"DEBUG: 查找 '{template_name}'，最高匹配度: {max_val:.4f}")
#######################################################################################################################
            if DEBUG:
                # 调试代码保持不变，现在它会显示正确的裁剪区域
                if template_name == debug_img:
                    try:
                        debug_path = "D:\\STMZ_app\\debug_images"
                        if not os.path.exists(debug_path):
                            os.makedirs(debug_path)
                        cv2.imwrite(os.path.join(debug_path, "DEBUG_01_HAYSTACK_FULL.png"), screen_cv)
                        if template is not None:
                            cv2.imwrite(os.path.join(debug_path, "DEBUG_02_TEMPLATE_YES.png"), template)
                        if mask is not None:
                            cv2.imwrite(os.path.join(debug_path, "DEBUG_03_TEMPLATE_MASK.png"), mask)
                        if screen_to_search is not None:
                            cv2.imwrite(os.path.join(debug_path, "DEBUG_04_HAYSTACK_ROI.png"), screen_to_search)
                        print(f"--- 调试图像已保存至 {debug_path} ---")
                    except Exception as e:
                        print(f"!!! 保存调试图像时出错: {e} !!!")
#######################################################################################################################

        if max_val >= confidence_threshold:
            # 5. 硬性边界检查 (逻辑保持不变)
            top_left_x = max_loc[0] + offset_x
            top_left_y = max_loc[1] + offset_y
            if roi is not None:
                roi_x, roi_y, roi_w, roi_h = roi
                if not (top_left_x >= roi_x and top_left_y >= roi_y and
                        top_left_x + template_w <= roi_x + roi_w and
                        top_left_y + template_h <= roi_y + roi_h):
                    if DEBUG:
                        print(f"DEBUG: 找到 '{template_name}'，但其位置超出其自定义ROI范围，已忽略。")
                    return False

            center_x = top_left_x + template_w // 2
            center_y = top_left_y + template_h // 2
            return center_x, center_y

        return False
    except IndexError:
        # 捕获潜在的因图片通道数不对导致的索引错误
        if DEBUG:
            print(f"[ERROR] 处理模板 '{template_name}' 时发生索引错误，请检查图片是否为常规彩色或灰度图。")
        return False
    except Exception as e:
        if DEBUG:
            print(f"在if_image_on_screen中发生未知错误: {e}")
        return False


def find_and_click_image(adb_path, device_serial, template_name, image_folder, confidence_threshold=0.8, click=True,
                         is_legend=False):
    """在ADB截图中查找图像，并可选地点击。修复了mask处理和nan值问题。"""
    try:
        # 1. 构建相对路径
        relative_folder = os.path.join(image_folder, 'legend') if is_legend else image_folder
        relative_path = os.path.join(relative_folder, f"{template_name}.png")

        template_path = resource_path(relative_path)

        if not os.path.exists(template_path):
            if DEBUG:
                print(f"[ERROR] 模板图片未找到。相对路径: '{relative_path}', 解析后路径: '{template_path}'")
            return None

        template_raw = cv2.imread(template_path, cv2.IMREAD_UNCHANGED)
        if template_raw is None:
            if DEBUG:
                print(f"错误：无法读取模板图片 '{template_path}'")
            return None

        mask = None
        if template_raw.shape[2] == 4:
            mask = template_raw[:, :, 3]
            template = cv2.cvtColor(template_raw, cv2.COLOR_BGRA2BGR)
        else:
            template = template_raw

        template_h, template_w = template.shape[:2]

        # 2. 获取截图
        screen_image = get_adb_screenshot(adb_path, device_serial)
        if screen_image is None:
            return None

        # 3. 确定搜索区域 (ROI)
        roi = None
        ROIS = ROIS_tw if "tw" in image_folder else ROIS_jp
        screen_to_search = screen_image
        offset_x, offset_y = 0, 0
        if template_name in ROIS:
            roi = ROIS[template_name]
            x, y, w, h = roi
            screen_to_search = screen_image[y:y + h, x:x + w]
            offset_x, offset_y = x, y

        # 4. 模板匹配
        result = cv2.matchTemplate(screen_to_search, template, cv2.TM_CCOEFF_NORMED, mask=mask)
        _, max_val, _, max_loc = cv2.minMaxLoc(result)

        if not np.isfinite(max_val):
            max_val = 0.0

        if DEBUG:
            print(f"DEBUG: 查找 '{template_name}'，最高匹配度: {max_val:.4f}")
#######################################################################################################################
            if DEBUG:
                # 调试代码保持不变，现在它会显示正确的裁剪区域
                if template_name == debug_img:
                    try:
                        debug_path = "D:\\STMZ_app\\debug_images"
                        if not os.path.exists(debug_path):
                            os.makedirs(debug_path)
                        cv2.imwrite(os.path.join(debug_path, "DEBUG_01_HAYSTACK_FULL.png"), screen_image)
                        if template is not None:
                            cv2.imwrite(os.path.join(debug_path, "DEBUG_02_TEMPLATE_YES.png"), template)
                        if mask is not None:
                            cv2.imwrite(os.path.join(debug_path, "DEBUG_03_TEMPLATE_MASK.png"), mask)
                        if screen_to_search is not None:
                            cv2.imwrite(os.path.join(debug_path, "DEBUG_04_HAYSTACK_ROI.png"), screen_to_search)
                        print(f"--- 调试图像已保存至 {debug_path} ---")
                    except Exception as e:
                        print(f"!!! 保存调试图像时出错: {e} !!!")
######################################################################################################################

        if max_val >= confidence_threshold:
            # 5. 硬性边界检查
            top_left_x = max_loc[0] + offset_x
            top_left_y = max_loc[1] + offset_y
            if roi is not None:
                roi_x, roi_y, roi_w, roi_h = roi
                if not (top_left_x >= roi_x and top_left_y >= roi_y and
                        top_left_x + template_w <= roi_x + roi_w and
                        top_left_y + template_h <= roi_y + roi_h):
                    return None

            # 6. 点击
            center_x = top_left_x + template_w // 2
            center_y = top_left_y + template_h // 2
            if click:
                adb_tap(center_x, center_y, adb_path, device_serial)
            return center_x, center_y
        else:
            return None
    except IndexError:
        if DEBUG:
            print(f"[ERROR] 处理模板 '{template_name}' 时发生索引错误，请检查图片格式。")
        return None
    except Exception as e:
        if DEBUG:
            print(f"图像识别或点击时发生错误: {e}")
        return None


def if_image_on_screen_GDI(capture_manager: ScreenCaptureManager, template_name, image_folder, confidence_threshold=0.8,
                           is_legend=False):
    """检查指定模板图片是否在当前屏幕上，并返回中心坐标。"""
    try:
        # 1. 从 Manager 获取最新一帧
        current_frame = capture_manager.get_latest_frame()
        if current_frame is None:
            if DEBUG:
                print("警告: if_image_on_screen 无法获取最新帧。")
            return False

        # 2. 在帧中查找模板
        coords = fast_find_template(
            current_frame,
            template_name,
            image_folder,
            is_legend,
            confidence_threshold
        )

        return coords if coords else False

    except Exception as e:
        if DEBUG:
            print(f"在 if_image_on_screen_GDI 中发生未知错误: {e}")
        traceback.print_exc()
        return False


def find_and_click_image_GDI(capture_manager: ScreenCaptureManager, adb_path, device_serial, template_name,
                             image_folder, confidence_threshold=0.8, click=True,
                             is_legend=False):
    """在ADB截图中查找图像，并可选地点击。修复了mask处理和nan值问题。"""
    try:
        # 1. 从 Manager 获取最新一帧
        current_frame = capture_manager.get_latest_frame()
        if current_frame is None:
            if DEBUG:
                print("警告: find_and_click_image 无法获取最新帧。")
            return None

        # 2. 在帧中查找模板
        coords = fast_find_template(
            current_frame,
            template_name,
            image_folder,
            is_legend,
            confidence_threshold
        )

        if coords:
            center_x, center_y = coords
            if click:
                # 3. 使用您已有的高速 adb_tap
                adb_tap(center_x, center_y, adb_path, device_serial)
            return center_x, center_y
        else:
            return None

    except Exception as e:
        if DEBUG:
            print(f"在 find_and_click_image_GDI 中发生未知错误: {e}")
        traceback.print_exc()
        return None


def click_press_and_release(adb_path, device_serial, activity_pic_template, image_folder, confidence_threshold,
                            is_legend=False):
    """专门用于稳定点击'start_game'按钮的函数"""

    if is_legend:
        image_folder = os.path.join(image_folder, "legend")

    coords = None
    # 循环直到找到坐标
    while coords is None:
        # 只找坐标，不点击
        coords = find_and_click_image(adb_path, device_serial, activity_pic_template, image_folder,
                                      confidence_threshold, click=False)
        if coords is None:
            time.sleep(0.5)

    # 找到坐标后，用 press_and_release 方法点击
    center_x, center_y = coords
    adb_press_and_release(center_x, center_y, adb_path, device_serial)
    return True


# --- 数据持久化函数 ---
DATA_DIR = "./data"
DAILY_CATFOOD_DATA = os.path.join(DATA_DIR, "catfood_daily_counts.txt")


def ensure_data_dir():
    if not os.path.exists(DATA_DIR):
        os.makedirs(DATA_DIR)


def get_today_count(script_name):
    ensure_data_dir()
    today_str = datetime.now().strftime('%Y-%m-%d')
    key = f"{today_str}_{script_name}"
    try:
        with open(DAILY_CATFOOD_DATA, 'r', encoding='utf-8') as file:
            for line in file:
                if line.startswith(key):
                    return int(line.strip().split(':')[1])
    except (FileNotFoundError, IndexError, ValueError):
        return 0
    return 0


def increment_today_count(script_name):
    ensure_data_dir()
    today_str = datetime.now().strftime('%Y-%m-%d')
    key = f"{today_str}_{script_name}"
    lines = []
    found = False
    count = 0
    try:
        with open(DAILY_CATFOOD_DATA, 'r', encoding='utf-8') as f:
            lines = f.readlines()
    except FileNotFoundError:
        pass
    with open(DAILY_CATFOOD_DATA, 'w', encoding='utf-8') as f:
        for i, line in enumerate(lines):
            if line.startswith(key):
                count = int(line.strip().split(':')[1]) + 1
                lines[i] = f"{key}:{count}\n"
                found = True
                break
        if not found:
            count = 1
            lines.append(f"{key}:{count}\n")
        f.writelines(lines)
    return count


def get_emulator_datetime(adb_path, device_serial):
    """从模拟器获取当前时间，并返回一个datetime对象。"""
    # 使用ISO 8601格式（YYYY-MM-DDTHH:MM:SS），这是最稳定、最无歧义的格式
    datetime_str = run_adb_command(adb_path, device_serial, "shell date +%Y-%m-%dT%H:%M:%S")
    if not datetime_str:
        return None
    try:
        return datetime.strptime(datetime_str, '%Y-%m-%dT%H:%M:%S')
    except ValueError:
        return None


def refresh_power(driver, package_name, image_folder, adb_path, device_serial, app_default=False, is_legend=False):
    """
    【精确恢复版】通过计算初始时间差，确保恢复后的时间对模拟器而言是连续且安全的。
    """
    initial_host_dt = datetime.now()
    initial_emulator_dt = get_emulator_datetime(adb_path, device_serial)

    if initial_emulator_dt is None:
        print("错误：无法获取模拟器初始时间，为保证安全，操作已中止。")
        return

    time_offset = initial_host_dt - initial_emulator_dt
    print(f"测量完成，时间差（Offset）为: {time_offset}")

    # Appium driver 仅用于管理应用状态
    close_app(driver, package_name, logger=print)

    # 修改时间
    run_adb_command(adb_path, device_serial, "shell settings put global auto_time 0")
    yesterday = datetime.now() - timedelta(days=2)
    yesterday_str = yesterday.strftime('%m%d%H%M%Y.%S')
    run_adb_command(adb_path, device_serial, f"shell \"su -c 'date {yesterday_str}'\"")
    time.sleep(0.01)

    # 启动游戏
    start_app(driver, package_name, logger=print)

    skip_found = False
    timeout = time.time() + 20
    while time.time() < timeout:
        if if_image_on_screen(adb_path, device_serial, "skip", image_folder, confidence_threshold=0.7):
            skip_found = True
            break
        time.sleep(1)

    if not skip_found:
        print("错误：等待skip按钮超时，恢复流程失败。")
        run_adb_command(adb_path, device_serial, "shell settings put global auto_time 1")
        return

    # 在找到skip后，执行精确的时间恢复
    current_host_dt = datetime.now()
    target_emulator_dt = current_host_dt - time_offset  # 用当前真实时间减去初始偏差
    target_time_str = target_emulator_dt.strftime('%m%d%H%M%Y.%S')
    run_adb_command(adb_path, device_serial, f"shell \"su -c 'date {target_time_str}'\"")
    run_adb_command(adb_path, device_serial, "shell settings put global auto_time 1")
    print(f"时间已安全恢复到: {target_emulator_dt.strftime('%Y-%m-%d %H:%M:%S')}")

    adb_tap(1772, 1012, adb_path, device_serial)
    time.sleep(0.5)
    adb_tap(1772, 1012, adb_path, device_serial)
    time.sleep(2.5)
    adb_tap(950, 659, adb_path, device_serial)
    time.sleep(0.5)
    adb_tap(950, 659, adb_path, device_serial)
    time.sleep(1.5)
    adb_tap(950, 659, adb_path, device_serial)

    # 轮询 OK_MAP 和 X 等待到达主界面（您的原始逻辑，保持不变）
    timeout = time.time() + 15
    while time.time() < timeout:
        if if_image_on_screen(adb_path, device_serial, "start_game", image_folder, confidence_threshold=0.8):
            break
        adb_press_and_release(1419, 676, adb_path, device_serial)
        time.sleep(0.5)
        adb_press_and_release(1649, 88, adb_path, device_serial)
        time.sleep(0.5)
        adb_press_and_release(1379, 597, adb_path, device_serial)

    if (not app_default) and (not is_legend):
        timeout = time.time() + 10
        while time.time() < timeout:
            if if_image_on_screen(adb_path, device_serial, "start_game", image_folder, confidence_threshold=0.7):
                break
            time.sleep(0.5)
        click_press_and_release(adb_path, device_serial, "start_game", image_folder, confidence_threshold=0.7)
    time.sleep(1)


def refresh_time_rapid(adb_path, device_serial):
    """
    【最终精确版 - 前向补偿】
    通过为目标时间增加一个微小的“前向补偿”来抵消执行延迟，
    确保最终设置的时间点精确落在或微超模拟器自身的连续时间，
    从而在保持极速的同时，彻底解决卡顿问题和封禁风险。
    """
    # 1.【一次读取】
    initial_host_dt = datetime.now()
    initial_emulator_dt = get_emulator_datetime(adb_path, device_serial)

    if initial_emulator_dt is None:
        print("错误 (refresh_time_rapid): 无法获取模拟器初始时间，操作中止。")
        run_adb_command(adb_path, device_serial, "shell settings put global auto_time 1")
        return

    # 2.【本地极速计算】
    time_offset = initial_host_dt - initial_emulator_dt
    yesterday_dt = initial_host_dt - timedelta(days=2)
    yesterday_str = yesterday_dt.strftime('%m%d%H%M%Y.%S')

    # 计算理论上的目标时间
    current_host_dt = datetime.now()
    target_emulator_dt_theoretical = current_host_dt - time_offset

    # 【核心修正】增加一个150毫秒的前向补偿，以抵消从现在到命令执行完毕的延迟。
    # 这确保了我们设置的时间点不会落在“过去”，从而避免卡顿。
    compensation_buffer = timedelta(milliseconds=150)
    target_emulator_dt_final = target_emulator_dt_theoretical + compensation_buffer

    target_time_str = target_emulator_dt_final.strftime('%m%d%H%M%Y.%S')

    # 3.【一次写入】
    command_chain = (
        f"settings put global auto_time 0 && "
        f"su -c 'date {yesterday_str}' && "
        # 在命令链中间加一个极短的sleep，确保“过去”状态能被系统识别，但对总时长影响甚微
        f"sleep 0.02 && "
        f"su -c 'date {target_time_str}' && "
        f"settings put global auto_time 1"
    )

    # 4. 执行命令链
    run_adb_command(adb_path, device_serial, f"shell \"{command_chain}\"")


def tap_cats_in_fight(positions_to_tap, adb_path, device_serial):
    for pos in positions_to_tap:
        adb_tap(pos[0], pos[1], adb_path, device_serial)
        time.sleep(0.25)


def roll_screen(adb_path, device_serial, start_x, start_y, end_x, end_y, duration_ms=300):
    try:
        adb_swipe(start_x, start_y, end_x, end_y, duration_ms, adb_path, device_serial)
    except Exception as e:
        if DEBUG:
            print(f"执行拖动时出错: {e}")


def roll_some_length(adb_path, device_serial, delta_length=200,
                     move_ms=default_long_roll_time_ms, roll_times=1, vertical=True):
    if delta_length > 1000:
        if DEBUG:
            print("长滚动参数错误。")
        return False

    if vertical:
        end_y = single_vertical_roll_START[1] - delta_length  # 向上滑动，Y 减小
        while roll_times > 0:
            time.sleep(0.5)
            roll_screen(
                adb_path,
                device_serial,
                single_vertical_roll_START[0], single_vertical_roll_START[1],
                single_vertical_roll_START[0], end_y,
                move_ms
            )
            roll_times -= 1

    else:
        end_x = single_level_roll_START[0] + delta_length  # 向右滑动，X 增加
        while roll_times > 0:
            time.sleep(0.5)
            roll_screen(
                adb_path,
                device_serial,
                single_level_roll_START[0], single_level_roll_START[1],
                end_x, single_level_roll_START[1],
                move_ms
            )
            roll_times -= 1

    time.sleep(long_roll_break)
    return True


def roll_and_find_spec_legend_activity(adb_path, device_serial, activity_pic_template, image_folder,
                                       confidence_threshold=0.8):
    """通过ADB滚动屏幕，查找并点击指定的活动图片。"""
    timeout = time.time() + 120
    while time.time() < timeout:
        time.sleep(0.5)
        # 使用基于ADB的图像识别
        if if_image_on_screen(adb_path, device_serial, activity_pic_template, image_folder, confidence_threshold,
                              is_legend=True):
            time.sleep(0.25)
            # 使用基于ADB的点击
            click_press_and_release(adb_path, device_serial, activity_pic_template, image_folder, confidence_threshold,
                                    is_legend=True)
            return True
        # 使用基于ADB的滚动
        roll_screen(
            adb_path,
            device_serial,
            single_vertical_roll_START[0], single_vertical_roll_START[1],
            single_vertical_roll_TOP_END[0], single_vertical_roll_TOP_END[1],
            single_vertical_duration_ms
        )
    return False


def get_correct_offset_str(timezone_name: str) -> str | None:
    try:
        tz = ZoneInfo(timezone_name)
        now_in_tz = datetime.now(tz)
        offset = now_in_tz.utcoffset()
        total_seconds = offset.total_seconds()
        hours, remainder = divmod(abs(total_seconds), 3600)
        minutes, _ = divmod(remainder, 60)
        sign = "-" if total_seconds < 0 else "+"
        return f"{sign}{int(hours):02d}:{int(minutes):02d}"
    except ZoneInfoNotFoundError:
        if DEBUG:
            print(f"警告：时区名称 '{timezone_name}' 无效或未找到。")
        return None


TIMEZONE_MAP = {tz_name: get_correct_offset_str(tz_name) for tz_name in TIMEZONE_KEYS if
                get_correct_offset_str(tz_name)}
REVERSE_TIMEZONE_MAP = {v: k for k, v in TIMEZONE_MAP.items()}


def change_time_zone(adb_path, device_serial, new_timezone_value):
    new_timezone = REVERSE_TIMEZONE_MAP.get(new_timezone_value)
    if not new_timezone:
        if DEBUG:
            print(f"错误：无法在REVERSE_TIMEZONE_MAP中找到值 {new_timezone_value}")
        return False

    if DEBUG:
        print(f"正在修改时区为: {new_timezone}...")
    run_adb_command(adb_path, device_serial, "shell settings put global auto_time_zone 0")
    run_adb_command(adb_path, device_serial, f"shell setprop persist.sys.timezone {new_timezone}")
    if DEBUG:
        print("时区修改完成。")
    return True


def recover_time_zone(adb_path, device_serial, original_timezone_name):
    if DEBUG:
        print(f"还原时区为: {original_timezone_name}...")
    run_adb_command(adb_path, device_serial, f"shell setprop persist.sys.timezone {original_timezone_name}")
    run_adb_command(adb_path, device_serial, "shell settings put global auto_time_zone 1")
    if DEBUG:
        print("时区还原完成。")
    return True


def get_current_datetime(adb_path, device_serial):
    date_format = '%Y-%m-%d %H:%M:%S'
    command = f"shell \"date +'{date_format}'\""
    datetime_str = run_adb_command(adb_path, device_serial, command)
    now = datetime.strptime(datetime_str, date_format)
    day_of_month = f"Day_{now.day:02}"
    day_of_week = week_day_kv[now.weekday()]
    time_period = now.strftime('%H:00')
    return {"day_of_month": day_of_month, "day_of_week": day_of_week, "time_period": time_period}


def handle_timezone_key(timezone):
    for offset_hours in range(-12, 15):
        if timezone == TIMEZONE_KEYS[12 + offset_hours]:
            timezone_str = f"{offset_hours:+03d}:00"
            return timezone_str


def calculate_activity_earliest_timezone_value(target_activity_name, adb_path, device_serial):
    datetime_str_with_tz = run_adb_command(adb_path, device_serial, "shell \"date +'%Y-%m-%d %H:%M:%S %z'\"")
    if not datetime_str_with_tz:
        return False, None
    try:
        device_now = datetime.strptime(datetime_str_with_tz, '%Y-%m-%d %H:%M:%S %z')
    except ValueError:
        return False, None
    utc_now = device_now.astimezone(timezone.utc)
    activity_info = next((act for act in activities_start_kv if act.get('act_name') == target_activity_name), None)
    if not activity_info:
        return False, None
    for offset_hours in range(-12, 15):
        target_tz = timezone(timedelta(hours=offset_hours))
        now_in_target_tz = utc_now.astimezone(target_tz)
        dates_to_check = [
            now_in_target_tz - timedelta(days=1),  # 昨天
            now_in_target_tz,  # 今天
            now_in_target_tz + timedelta(days=1)  # 明天
        ]
        for date_obj in dates_to_check:
            is_weekly = 'Day_01' not in activity_info
            day_key = week_day_kv[date_obj.weekday()] if is_weekly else f"Day_{date_obj.day:02}"
            time_slots = activity_info.get(day_key, [])
            for slot in time_slots:
                try:
                    start_str, end_str = slot.split('-')
                    start_t = dtime.fromisoformat(start_str)
                    end_t = dtime.fromisoformat(end_str.replace("24:00", "23:59"))
                    start_dt = date_obj.replace(hour=start_t.hour, minute=start_t.minute, second=0, microsecond=0,
                                                tzinfo=target_tz)
                    end_dt = date_obj.replace(hour=end_t.hour, minute=end_t.minute, second=59, microsecond=0,
                                              tzinfo=target_tz)
                    if end_dt < start_dt:
                        end_dt += timedelta(days=1)
                    if start_dt <= now_in_target_tz <= end_dt:
                        timezone_str = f"{offset_hours:+03d}:00"
                        final_start_dt = date_obj.replace(hour=start_t.hour, minute=start_t.minute, second=0,
                                                          microsecond=0, tzinfo=target_tz)
                        return timezone_str, final_start_dt
                except (ValueError, IndexError):
                    continue
    return False, None


def get_visible_window_titles():
    """
    获取当前桌面上所有可见窗口的标题列表。
    过滤掉不可见、无标题以及系统窗口。
    """
    titles = []

    def enum_windows_proc(hwnd, lParam):
        # 检查窗口是否可见
        if win32gui.IsWindowVisible(hwnd):
            # 检查窗口是否有标题
            title = win32gui.GetWindowText(hwnd)
            if title:
                # 进一步过滤掉一些常见的系统/无用窗口
                # GetWindowLong(hwnd, GWL_STYLE) 可以获取窗口样式
                style = win32gui.GetWindowLong(hwnd, win32con.GWL_STYLE)
                # WS_DISABLED: 窗口被禁用
                if not (style & win32con.WS_DISABLED):
                    # 过滤掉程序管理器等
                    if 'Program Manager' not in title:
                        titles.append(title)

    try:
        win32gui.EnumWindows(enum_windows_proc, None)
        # 返回一个去重且排序后的列表，方便查看
        return sorted(list(set(titles)))
    except Exception as e:
        print(f"获取窗口列表时出错: {e}")
        return ["错误：无法获取窗口列表"]
